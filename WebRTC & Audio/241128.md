# MediaSoup

- `media_origin`: 나의 마이크, 비디오 스트림을 전송
- `media_edge`: 상대방의 마이크, 비디오 스트림을 수신

## enter room seqeunce

```mermaid
sequenceDiagram
    participant MB as MediaBloc
    participant NC as Nacho
    participant FL-MS as mediasoup_client_flutter
    
    MB->>NC: enterMediaSoup()
    Note over MB,FL-MS: 1. 수신부 연결 (consume, edge)
    NC->>FL-MS: Device 객체 생성
    Note over NC,FL-MS: 1-1. initial connection Phase
    NC->>FL-MS: WebSocket 연결 요청 및 리스너 등록 (connect)
    NC->>FL-MS: 방 생성 소켓 이벤트 발행 (room_id)
    NC->>FL-MS: 방 입장 소켓 이벤트 발행 (type, room_id, member_no)
    NC->>FL-MS: RTPCapbility 정보 요청 (getRouterRTPCapability)
    FL-MS-->>NC: return RTPCapbility (await `getRouterRTPCapability`)
    NC->>FL-MS: load device (with RTPCapability)
    Note over NC,FL-MS: 1-2. transport 설정 Phase
    NC->>FL-MS: Transport 생성 요청 (createWebRTCTransport)
    FL-MS-->>NC: return Transport 파라미터 정보 (ID, ICE, DTLS)
    Note over NC,FL-MS: 1-3. transport 연결 Phase
    NC->>FL-MS: Transport 파라미터 설정 및 생성 (Recv)
    NC->>FL-MS: connect Transport (with DTLS Parameter)
    NC->>NC: callback(): 연결이 성공했음을 알림
    Note over NC,FL-MS: 1-4. Producer / Consumer 설정
    NC->>FL-MS: Producer 정보 요청, emit('getProducers')
    

```

- WebSocket을 통해 주고 받는 정보들
  - SDP 정보 교환
  - ICE candidate 정보 교환
  - 룸 입장 / 퇴장 알림
  - 참가자 목록 관리
  - producer / consumer 정보
  - 미디어 설정 변경 요청 등
