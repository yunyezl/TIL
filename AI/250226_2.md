# Part 3. 프롬프트 엔지니어링 기초

프롬프트 엔지니어링 과정은 다음과 같은 5단계로 세분화할 수 있다.

1. **프롬프트 결과 설정**
  먼저 원하는 답변이나 결과의 유형을 명확히 정의한다. 이 단계에서는 최종적으로 얻고자 하는 정보의 종류와 형태를 결정한다.
2. **프롬프트 평가 설계**
  설정한 목표를 달성하고자 할 때 프롬프트의 효과를 어떻게 평가할지에 대한 기준을 마련한다. 이는 프롬프트가 원하는 결과를 얼마나 잘 도출해 내는지 측정하는 메커니즘을 개발하는 것을 포함한다. 업무에 본격적으로 사용할 때는 프롬프트를 반복적으로 사용하여 업무를 자동화하는 것을 목표로 한다. 따라서 이 과정이 가장 중요하다.
3. **그라운딩 설계 및 평가**
  그라운딩은 AI가 답변을 생성할 . 때신뢰할 수 있는 정보나 데이터에 기반하여 정확성과 연관성을 확보하는 과정이다. 이 단계에서는 모델이 참조할 기초 데이터나 사실들을 정리한다.
4. **프롬프트 디자인**
  앞서 정의한 목표와 평가 기준에 따라 실제 프롬프트를 설계한다. 이 단계는 창의성과 실험적 접근이 필요하며, 여러 시도를 통해 최적의 프롬프트 구조를 찾아간다.
5. **모니터링 및 개선**
  원하는 목적을 달성하는 프롬프트를 잘 만들었다면 이를 실제 업무에 반영한다. 프롬프트가 실제 환경에서 사용되는 동안에는 지속적으로 성능을 모니터링하고 필요한 경우에는 개선하는 것이 중요하다. 여기에는 사용자의 피드백을 반영하고 새로운 데이터나 정보가 등장했을 때 프롬프트를 업데이트하여 최신 상태를 유지하는 과정이 포함된다.

## 자기 일관성

자기 일관성은 CoT보다 AI가 더 정확하고 신뢰할 수 있는 답변을 제공하도록 설계된 기법으로, 동일한 문제에 대해 여러 가지 다른 추론 경로를 고려한 후 가장 일관되게 나온 답을 선택한다. 이는 마치 여러 사람에게 각자 해결 방안을 생각해 보라고 한 뒤 가장 반복적으로 나온 답을 선택하는 과정과 유사하다.

자기 일관성의 수행 능력을 측정하는 논문 실험 결과, 약 20개 정도의 예제를 주는 것이 가장 효과적인 것으로 나타났다.  
자기 일관성 측정 지표에는 `temperature`, `top-k`라는 용어가 나오는데 이는 각각 다음과 같은 의미를 가진다.

- T(Temperature): T 값이 낮을수록 높은 확률을 가진 경로를 위주로 선택할 가능성이 커지며, 더 높은 T 값은 더 다양한 경로를 탐색할 가능성이 높다.
- K(top-k 샘플링): 이는 모델이 다음 단계에서 고려할 수 있는 가능한 경로의 최대 수를 제한한다. 예를 들어 k=40은 다음 단계에서 최대 40개의 경로를 고려한다는 것을, 'no top k'는 top-k 샘플링을 사용하지 않았음을 의미한다.

## 샘플링 투표

샘플링 투표는 자기 일관성과 개념적으로 유사하지만 몇 가지 차이점이 있다.:

- 복잡한 CoT 프롬프팅 대신 기본적인 지시를 사용하고 출력을 가공 없이 활용한다.
- 단순히 출력 간 유사도를 계산하여 다수결로 답안을 선정한다.
- 추론 작업뿐만 아니라 코드 생성 등 다양한 작업에 대해 일반화된 접근법이다.
- 자기 일관성과 결합하여 상호 보완적으로 활용할 수 있다.

샘플링 단계에서는 작업에 대한 질의 혹은 지시를 LLM에게 N번 반복하여 출력 샘플을 다양하게 생성한다. 이 때 다양한 출력을 얻기 위해 별도의 페르소나를 설정하거나 서로 다른 LLM 모델을 사용할 수도 있지만, 별도의 페르소나 설정 없이도 동일한 입력에 대해 같은 LLM을 단순히 반복 실행하는 방식을 사용해도 된다.

다수결 투표를 통해 이 샘플들 중 가장 일관성 있는 출력을 최종 답변으로 선택한다. 투표 단계에서는 각각의 샘플에 대한 다른 모든 샘플과의 유사도를 계산하여 누적된 유사도 점수를 구한다. 유사도는 임베딩 벡터로 계산하거나 BLEU 점수 등을 사용한다. 객관식 문제에서는 답안의 출현 빈도수로 유사도 누적 점수를 계산한다. 이를 통해 가장 높은 누적 유사도를 얻은 샘플을 최종 답변으로 선택한다.
