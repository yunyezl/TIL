# 8장. 통합 테스트를 하는 이유

## 통합 테스트란?

- 단위 테스트는 다음 세 가지 요구 사항을 충족
  - 단일 동작 단위를 검증
  - 빠르게 수행
  - 다른 테스트와 별도 처리
- 위 세 가지 조건 중, 하나라도 충족하지 못하는 테스트는 통합 테스트 범주에 속함
- 단위 테스트로 가능한 한 많이 비즈니스 시나리오의 예외 상황을 확인하고, 통합 테스트는 주요 흐름과 단위 테스트가 다루지 못하는 기타 예외 상황을 다룸
  - 단위 테스트가 다루지 못하는 기타 예외 상황: 목으로 대체할 수 없는 프로세스 외부 의존성 (대개 데이터베이스)
- 시스템이 프로세스 외부 의존성과 어떻게 통합하는지를 검증

## 통합 테스트와 빠른 실패

- 비즈니스 시나리오 당 하나의 주요 흐름과 단위 테스트로 처리할 수 없는 모든 예외 상황을 다루는 지침에 대한 설명
- 통합 테스트에서 프로세스 외부 의존성과의 상호 작용을 모두 확인하기 위해서는 가장 긴 주요 흐름을 선택해야 함
  - 모든 상호 작용을 거치는 흐름이 없으면, 외부 시스템과의 통신을 모두 확인하는 데 필요한 만큼 통합 테스트를 추가로 작성해야 함

## 프로세스 외부 의존성의 두 가지 유형

- 어떤 프로세스 외부 의존성을 직접 테스트해야 하는가?
- 프로세스 외부 의존성의 두 가지 유형
  1. **관리 의존성**(전체를 제어할 수 있는 프로세스 외부 의존성): 애플리케이션을 통해서만 접근할 수 있으며 외부 환경에서 볼 수 없는 의존성. (DB)
  2. **비관리 의존성**(전체를 제어할 수 없는 프로세스 외부 의존성): 해당 의존성과의 상호 작용을 외부에서 볼 수 있음. (SMTP 서버, 메시지 버스)
- 관리 의존성은 구현 세부 사항이지만, 비관리 의존성과의 통신은 시스템의 식별할 수 있는 동작으로 통합 테스트에서의 프로세스 외부 의존성 처리가 달라짐.
- 관리 의존성이면서 비관리 의존성인 프로세스 외부 의존성 다루기
  - 전용 데이터 베이스로 시작했지만 다른 시스템의 요구 사항으로 인해 일부 테이블만 접근 권한을 공유하는 상황
  - 시스템 간의 통합을 구현하는 데 있어서 데이터베이스를 사용하는 것은 좋지 않으므로, API 혹은 메시지 버스를 사용하는 것이 더 좋음
  - 그러나 그렇지 않은 상황에서는, 해당 데이터베이스를 비관리 의존성으로 취급함
